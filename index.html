<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket client</title>
</head>

<body>
    Welcome to the socket client
    <input id="message-box" type="text">
    <button id="message-button">Click to send message</button>

    <button id="reach-user">Reach user</button>
    <button id="list-user">List Users</button>
    <button id="message-list">Message List</button>
    <button id="list-channels">List channels</button>
    <button id="download">Download attachment</button>
    <button id="ack-message">Ack message</button>

    <button id="notification-list">Notification List</button>
    <button id="ack-notification">Ack Notification</button>

    <button id="notification-unread-count">Notification unread count</button>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>
        const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjA2ZjA0NDFjLTgwZjYtNDNmNi1hOTYzLTAzYzdiNmNjMmUyMSIsImlhdCI6MTc0MTk2ODEwOSwiZXhwIjoxNzQxOTcxNzA5fQ._gdmeGJe5phx6x-dyzonhuC0WqbVw8V-mDbCOEG0-Zg'

        var socket = io("http://localhost:3006", {
            transportOptions: {
                polling: {
                    extraHeaders: {
                        Authorization: `Bearer ${token}`
                    }
                }
            }
        });

        const channelId = '186b5578-3440-474d-88a5-bba8ba73e000';
        const userToReach = 'ec36d4db-7579-40ce-8d99-fd1238134585';

        socket.on("connect", () => {
            console.log("Connected to server");
        });

        socket.on("disconnect", () => {
            console.log("Disconnected from server");
        });

        socket.on("message:new", (data) => {
            console.log("Message received")
            console.log(data);
        });

        socket.on("notification:new", (data) => {
            console.log("Notification received")
            console.log(data);
        });

        document.getElementById("message-button").addEventListener("click", (e) => {
            let message = document.getElementById("message-box").value;
            socket.emit("message:send", {
                channelId,
                content: message,
                attachments: ['file1new', 'file2new']
            }, (data) => {
                console.log("Message  sent")
                console.log(data);
            });
        });

        document.getElementById("reach-user").addEventListener("click", () => {
            socket.emit("user:reach", {
                userId: userToReach
            }, (data) => {
                console.log("Reached User")
                console.log(data);
            });
        });

        document.getElementById("list-channels").addEventListener("click", () => {
            socket.emit("channel:list", {
                page: 1,
                size: 10
            }, (data) => {
                console.log("List of channels")
                console.log(data);
            });
        });

        document.getElementById("message-list").addEventListener("click", () => {
            socket.emit("message:list", {
                channelId,
                page: 1,
                size: 10
            }, (data) => {
                console.log("List of messages")
                console.log(data);
            });
        });

        document.getElementById("ack-message").addEventListener("click", () => {
            socket.emit("message:ack", {
                messageId: 20,
                channelId,
            }, (data) => {
                console.log("Message ack")
                console.log(data);
            });
        });

        document.getElementById("list-user").addEventListener("click", () => {
            socket.emit("user:list", {
                page: 1,
                size: 10
            }, (data) => {
                console.log("List of users")
                console.log(data);
            });
        });

        document.getElementById("download").addEventListener("click", () => {
            socket.emit("message:attachment:download", {
                attachmentId: '65d8c2ba-829b-49ff-9b6f-bf24b19b9ddb',
                channelId
            }, (data) => {
                console.log("Download attachment")
                console.log(data);
            });
        });

        document.getElementById("notification-list").addEventListener("click", () => {
            socket.emit("notification:list", {
                page: 1,
                size: 10
            }, (data) => {
                console.log("List of notifications")
                console.log(data);
            });
        });

        document.getElementById("ack-notification").addEventListener("click", () => {
            socket.emit("notification:ack", {
                notificationId: 2
            }, (data) => {
                console.log("Notification ack")
                console.log(data);
            });
        });

        document.getElementById("notification-unread-count").addEventListener("click", () => {
            socket.emit("notification:unreadcount", {}, (data) => {
                console.log("Notification unread count")
                console.log(data);
            });
        });
    </script>

</body>

</html>